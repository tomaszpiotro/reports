<!DOCTYPE html>
<html>
<head>
        <title>Report</title>
        {% load staticfiles %}

    <script type="text/javascript" src = "{% static 'assets/js/jquery.min.js' %} "></script>
    <script type="text/javascript" src = "{% static 'js/highcharts/highcharts.js' %} "></script>

        <style type="text/css">
            #moving_bar {
                    background-color: rgba(100, 100, 100, 0);
                    width: 100%;
                    position: absolute;
                    top: 0;
                    left: 0;
                 }
        </style>


</head>
<body bgcolor="lightblue">
<div id="moving_bar">
    <button type="button" id="hide_button"> Toggle chart</button>
    <div id = 'chart'> </div>
</div>

<table border="1" align="center" cellpadding="2" cellspacing="0" bgcolor="orange" bordercolor="darkblue">
    <td align="center" colspan="9"> <font size="5"> Report from <b>{{report.date|date:"d-m-Y H:i" }} to {{end_date|date:"d-m-Y H:i"}} ({{report.interval}} hours)</b> </font></td>
<tr>
    <th align="center"> id </th>
    <th align="center"> protocol </th>
    <th align="center"> remote host </th>
    <th align="center"> remote port </th>
    <th align="center"> local host </th>
    <th align="center"> local port </th>
    <th align="center"> count </th>
    <th align="center"> interesting </th>
    <th align="center"> prev occurrences </th>

</tr>

    {% for freq_item in reports_fitemsets %}
<tr onclick="paint{{freq_item.0.id}}();">
    <td align="center"> {{freq_item.0.id}} </td>
    <td align="center"> {{freq_item.0.protocol}} </td>
    <td align="center"> {{freq_item.0.remote_host}} </td>
    <td align="center"> {{freq_item.0.remote_port}} </td>
    <td align="center"> {{freq_item.0.local_host}} </td>
    <td align="center"> {{freq_item.0.local_port}} </td>
    <td align="center"> {{freq_item.0.count}} </td>
    <td align="center"> {{freq_item.0.interesting}} </td>
    <td align="center"><span id='{{freq_item.0.id}}'>{{freq_item.1}} </span> </td>
</tr>
    {% endfor %}
</table>

<script>
$(window).scroll(function(){
  $("#moving_bar").stop().animate({"marginTop": ($(window).scrollTop()) + "px", "marginLeft":($(window).scrollLeft()) + "px"}, "slow" );});
</script>

{% for id,occurrence in occurrences.items %}
<script>
function paint{{id}}(){
window.lastChart='paint{{id}}'
$('#chart').highcharts({
        chart: {
            zoomType: 'x'
        },
        title: {
            text: 'occurrences {{id}}'
        },
        subtitle: {
            text: document.ontouchstart === undefined ?
                    'Click and drag in the plot area to zoom in' :
                    'Pinch the chart to zoom in'
        },
        xAxis: {
            type: 'datetime',
            minRange: 14 * 24 * 3600000 // fourteen days
        },
        yAxis: {
            title: {
                text: 'number of occurrences'
            }
        },
        legend: {
            enabled: false
        },
        plotOptions: {
            area: {
                fillColor: {
                    linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1},
                    stops: [
                        [0, Highcharts.getOptions().colors[0]],
                        [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
                    ]
                },
                marker: {
                    enabled: false
                },
                lineWidth: 1,
                states: {
                    hover: {
                        lineWidth: 1
                    }
                },
                threshold: null
            }
        },

        series: [{
            type: 'area',
            name: 'occurrences',
            pointInterval: 24 * 3600 * 1000,
            pointStart: Date.UTC({{occurrence.start_date.year}}, {{occurrence.start_date.month}}, {{occurrence.start_date.day}}),
            data: {{occurrence.data}}
        }]
    })
}
</script>

{% endfor %}

<script>
    $('#hide_button').click(function() {
    $('#chart').slideToggle();
    var fn = window[window.lastChart];
    fn();
});
</script>
</body>
</html>